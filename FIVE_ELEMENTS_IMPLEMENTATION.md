# 五行分析功能实现文档

## 功能概述

本项目实现了一个完整的五行分析系统，结合用户生辰（基本盘）和内观数据（后天身体状态）进行中医五行科普和分析。

## 已实现功能

### 1. 五行分析系统 (✅ 已完成)

#### 数据模型
- **五行类型定义** (`/src/types/five-elements.ts`)
  - 基本五行分布（基于生辰）
  - 动态五行分布（基于身体状态）
  - 五行相克关系
  - 调理建议结构

#### 算法实现
- **五行计算核心** (`/src/lib/five-elements-analysis.ts`)
  - 生辰五行计算（基于天干地支）
  - 动态五行分析（基于睡眠、情绪、饮食、症状）
  - 平衡度计算
  - 体质判断

### 2. 顺时页面五行分析 (✅ 已完成)

#### 功能特性
- **双标签页设计**
  - 养生建议（原有功能）
  - 五行分析（新增功能）

#### 五行分布图
- **五边形雷达图** (`/src/components/FiveElementsChart.tsx`)
  - 基本五行 vs 动态五行对比
  - 交互式元素点击
  - 数据可视化展示

#### 五行相克关系图
- **圆形关系图** (`/src/components/FiveElementsRelation.tsx`)
  - 相生关系（绿色曲线）
  - 相克关系（红色虚线）
  - 交互式元素点击
  - 悬停效果

#### 调理建议
- **详细建议面板**
  - 饮食建议
  - 运动建议
  - 生活建议
  - 宜忌列表
  - 点击元素显示对应建议

### 3. 数据统计分析 (✅ 已完成)

#### Pro用户功能
- **统计分析页面** (`/src/app/five-elements-stats/page.tsx`)
  - 时间段选择（7天/30天/90天）
  - 统计摘要展示
  - 五行趋势图表
  - 平衡度变化图表
  - 详细数据表格

#### 折线图组件
- **可响应图表** (`/src/components/LineChart.tsx`)
  - 多线对比
  - 自适应宽度
  - 图例显示
  - 数据点标记

#### Pro权限控制
- **升级页面**
  - Pro功能介绍
  - 升级按钮
  - 权限验证

### 4. API接口 (✅ 已完成)

#### 五行分析API
- **分析接口** (`/src/app/api/five-elements/analysis/route.ts`)
  - 获取用户档案和身体数据
  - 计算五行分布
  - 保存分析结果

#### 统计数据API
- **统计接口** (`/src/app/api/five-elements/stats/route.ts`)
  - 获取时间段数据
  - 计算统计摘要
  - 趋势分析

### 5. 数据库设计 (✅ 已完成)

#### 新增表结构
- **五行分析表** (`five_elements_analysis`)
  - 基本五行分布
  - 动态五行分布
  - 平衡度和体质
  - 用户和时间索引

#### 用户档案扩展
- **生辰信息字段**
  - 出生年月日时
  - 性别信息
  - 支持五行计算

## 技术架构

### 前端技术栈
- **React 19.1.0** - 用户界面框架
- **Next.js 15.4.6** - 全栈框架
- **TypeScript** - 类型安全
- **Tailwind CSS** - 样式框架
- **Lucide React** - 图标库
- **Supabase** - 数据库和认证

### 核心算法
- **天干地支计算** - 传统中医五行计算
- **动态影响分析** - 基于身体状态的影响因子
- **平衡度评估** - 五行平衡量化指标
- **体质识别** - 体质类型判断算法

### 数据可视化
- **SVG图表** - 自定义五行图表
- **响应式设计** - 适配不同屏幕尺寸
- **交互式界面** - 点击和悬停效果
- **实时更新** - 数据动态展示

## 使用说明

### 用户流程
1. **填写生辰信息** - 在个人档案中填写出生年月日时
2. **记录身体数据** - 每日记录睡眠、情绪、饮食、症状
3. **查看五行分析** - 在顺时页面查看五行分布和相克关系
4. **获取调理建议** - 点击五行元素获取个性化建议
5. **统计分析（Pro）** - 查看历史趋势和统计分析

### 开发说明
1. **数据库迁移** - 运行 `003_add_five_elements.sql` 创建表结构
2. **环境配置** - 确保Supabase配置正确
3. **依赖安装** - 确保所有npm依赖已安装
4. **开发调试** - 使用 `npm run dev` 启动开发服务器

## 文件结构

```
src/
├── types/
│   ├── database.ts              # 数据库类型定义
│   └── five-elements.ts         # 五行分析类型
├── lib/
│   ├── five-elements-analysis.ts # 五行计算核心算法
│   └── supabase.ts              # 数据库操作
├── components/
│   ├── FiveElementsChart.tsx    # 五行分布图组件
│   ├── FiveElementsRelation.tsx  # 五行相克关系图
│   └── LineChart.tsx            # 折线图组件
├── app/
│   ├── shunshi/
│   │   └── page.tsx             # 顺时养生页面
│   ├── five-elements-stats/
│   │   └── page.tsx             # 统计分析页面
│   └── api/
│       ├── five-elements/
│       │   ├── analysis/
│       │   │   └── route.ts      # 五行分析API
│       │   └── stats/
│       │       └── route.ts      # 统计数据API
scripts/
└── migrations/
    └── 003_add_five_elements.sql # 数据库迁移
```

## 未来扩展

### 功能增强
1. **更多体质类型** - 支持更复杂的体质分类
2. **季节性分析** - 结合节气和季节变化
3. **地理位置影响** - 考虑地域五行特性
4. **AI建议优化** - 结合大语言模型提供更精准建议

### 技术优化
1. **性能优化** - 大数据量的图表渲染优化
2. **离线支持** - 本地数据缓存和离线访问
3. **数据导出** - 支持PDF和Excel报告导出
4. **多语言支持** - 国际化功能

## 总结

五行分析功能已经完整实现，包括：

✅ **数据模型和算法设计** - 完整的五行计算体系
✅ **可视化界面** - 交互式图表和关系图
✅ **调理建议** - 个性化养生建议
✅ **统计分析** - 历史趋势和数据对比
✅ **Pro权限控制** - 付费功能权限管理
✅ **API和数据库** - 完整的后端支持

该功能为用户提供了专业级的中医五行分析体验，帮助用户更好地了解自己的身体状况并获得个性化的养生建议。