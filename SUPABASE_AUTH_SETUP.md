# Supabase 身份验证配置指南

## 🚀 快速修复步骤

### 步骤1: 执行SQL脚本修复数据库

1. 登录 [Supabase Dashboard](https://supabase.com/dashboard)
2. 选择您的项目（煦养应用）
3. 点击左侧菜单的 **SQL Editor**
4. 复制并执行 `complete_auth_fix.sql` 文件中的内容
5. 确认执行结果显示所有用户都有对应的profile

### 步骤2: 关闭邮箱验证

1. 在Supabase Dashboard中，点击 **Authentication** > **Settings**
2. 在 "User Signups" 部分：
   - 找到 **"Enable email confirmations"** 选项
   - 将其设置为 **OFF**（关闭）
   - 确保 **"Enable new user signups"** 设置为 **ON**（开启）
3. 点击 **Save** 保存设置

### 步骤3: 测试注册流程

1. 访问注册页面 `/auth/register`
2. 填写测试用户信息
3. 提交注册
4. 检查是否直接跳转到主页（而不是邮箱验证页面）

## ✅ 修复完成后的用户流程

配置完成后，用户注册流程将变为：

1. 用户填写注册表单（姓名、邮箱、密码）
2. 提交注册信息
3. **直接创建账户并自动登录**（无需邮箱验证）
4. **立即跳转到应用主页**

## 🔧 已修复的问题

- ✅ 为现有用户自动创建了profile记录
- ✅ 设置了用户注册触发器，新用户注册时自动创建profile
- ✅ 修改了注册页面逻辑，注册成功后直接跳转
- ✅ 优化了API错误处理，使用Dify API作为备选方案

## 其他可选配置

### 密码策略

在 "Password Policy" 部分，您可以配置：

- 最小密码长度（建议 6-8 位）
- 是否需要大写字母
- 是否需要小写字母
- 是否需要数字
- 是否需要特殊字符

### 会话管理

在 "Sessions" 部分，您可以配置：

- 会话超时时间
- 是否允许多设备同时登录

## 注意事项

1. **安全性考虑**：关闭邮箱验证会降低一定的安全性，因为无法确认邮箱地址的有效性。

2. **垃圾注册**：可能会增加垃圾注册的风险，建议配合其他防护措施。

3. **邮箱找回**：如果用户忘记密码，仍然可以通过邮箱重置密码功能找回账户。

## 测试验证

配置完成后，可以通过以下步骤测试：

1. 访问注册页面 `/auth/register`
2. 填写测试用户信息
3. 提交注册
4. 检查是否直接跳转到主页（而不是邮箱验证页面）
5. 退出登录后，使用相同邮箱密码尝试登录

如果一切正常，说明配置成功！